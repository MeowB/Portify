import './NavBar.scss'
import powerIcon from '../../resources/favicon.ico'
import { useEffect, useState } from 'react'
import { Link, useNavigate } from 'react-router-dom'

const NavBar = () => {
	const [showTooltip, setShowTooltip] = useState<boolean>(false)
	const [imageUrl, setImageUrl] = useState<string | null>(localStorage.getItem('imageUrl') || '')
	const navigate = useNavigate()

	const handleProfileClick = () => {
		setShowTooltip(!showTooltip)
	}

	const handleLogout = () => {
		localStorage.removeItem('token')
		localStorage.removeItem('userId')
		localStorage.removeItem('email')
		localStorage.removeItem('imageUrl')
		navigate('/', { replace: true })
	}

	useEffect(() => {
		const fetchImgUrl = () => {
			const imgUrl = localStorage.getItem('imageUrl');
			setImageUrl(imgUrl);
		}

		const interval = setInterval(() => {
			const latest = localStorage.getItem('imageUrl')
			setImageUrl(latest || '')
		})


		fetchImgUrl();
		return () => clearInterval(interval)
	}, [])

	return (
		<nav>
			<div className="logo">
				<img src={powerIcon} alt="" />
				<p className="logo-text">MeowB</p>
			</div>

			<div className="settings">
				<div className="profile-image" onClick={handleProfileClick}>
					{imageUrl ? (
						<img src={imageUrl} alt='profile image' />
					) : (

						<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M12 2C10.0605 2.00369 8.16387 2.57131 6.54122 3.63374C4.91856 4.69617 3.63988 6.20754 2.86093 7.98377C2.08197 9.76 1.83636 11.7244 2.15401 13.6378C2.47166 15.5511 3.33887 17.3308 4.64999 18.76C5.58641 19.775 6.72293 20.5851 7.98793 21.1392C9.25292 21.6933 10.619 21.9793 12 21.9793C13.381 21.9793 14.7471 21.6933 16.012 21.1392C17.277 20.5851 18.4136 19.775 19.35 18.76C20.6611 17.3308 21.5283 15.5511 21.846 13.6378C22.1636 11.7244 21.918 9.76 21.139 7.98377C20.3601 6.20754 19.0814 4.69617 17.4588 3.63374C15.8361 2.57131 13.9395 2.00369 12 2ZM12 20C9.92845 19.9969 7.9389 19.1903 6.44999 17.75C6.90203 16.6495 7.67102 15.7083 8.65924 15.0459C9.64746 14.3835 10.8103 14.0298 12 14.0298C13.1897 14.0298 14.3525 14.3835 15.3407 15.0459C16.329 15.7083 17.0979 16.6495 17.55 17.75C16.0611 19.1903 14.0715 19.9969 12 20ZM9.99999 10C9.99999 9.60444 10.1173 9.21776 10.337 8.88886C10.5568 8.55996 10.8692 8.30362 11.2346 8.15224C11.6001 8.00087 12.0022 7.96126 12.3902 8.03843C12.7781 8.1156 13.1345 8.30608 13.4142 8.58579C13.6939 8.86549 13.8844 9.22186 13.9616 9.60982C14.0387 9.99778 13.9991 10.3999 13.8477 10.7654C13.6964 11.1308 13.44 11.4432 13.1111 11.6629C12.7822 11.8827 12.3955 12 12 12C11.4696 12 10.9608 11.7893 10.5858 11.4142C10.2107 11.0391 9.99999 10.5304 9.99999 10ZM18.91 16C18.0165 14.4718 16.6414 13.283 15 12.62C15.5092 12.0427 15.8409 11.3307 15.9555 10.5694C16.07 9.80822 15.9625 9.03011 15.6457 8.3285C15.329 7.62688 14.8166 7.03156 14.1699 6.61397C13.5232 6.19637 12.7698 5.97425 12 5.97425C11.2302 5.97425 10.4768 6.19637 9.83008 6.61397C9.1834 7.03156 8.67096 7.62688 8.35424 8.3285C8.03752 9.03011 7.92997 9.80822 8.04452 10.5694C8.15906 11.3307 8.49082 12.0427 8.99999 12.62C7.35859 13.283 5.98346 14.4718 5.08999 16C4.37793 14.7871 4.00171 13.4065 3.99999 12C3.99999 9.87827 4.84284 7.84344 6.34313 6.34315C7.84342 4.84285 9.87826 4 12 4C14.1217 4 16.1566 4.84285 17.6568 6.34315C19.1571 7.84344 20 9.87827 20 12C19.9983 13.4065 19.622 14.7871 18.91 16Z" fill="#F2F5F9" />
						</svg>
					)}

				</div>

				{showTooltip && (
					<div className="tooltip">
						<div className='profile-preview'>
							<div className="profile-image">
								{imageUrl ? (
									<img src={imageUrl} alt='profile image' />
								) : (

									<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
										<path d="M12 2C10.0605 2.00369 8.16387 2.57131 6.54122 3.63374C4.91856 4.69617 3.63988 6.20754 2.86093 7.98377C2.08197 9.76 1.83636 11.7244 2.15401 13.6378C2.47166 15.5511 3.33887 17.3308 4.64999 18.76C5.58641 19.775 6.72293 20.5851 7.98793 21.1392C9.25292 21.6933 10.619 21.9793 12 21.9793C13.381 21.9793 14.7471 21.6933 16.012 21.1392C17.277 20.5851 18.4136 19.775 19.35 18.76C20.6611 17.3308 21.5283 15.5511 21.846 13.6378C22.1636 11.7244 21.918 9.76 21.139 7.98377C20.3601 6.20754 19.0814 4.69617 17.4588 3.63374C15.8361 2.57131 13.9395 2.00369 12 2ZM12 20C9.92845 19.9969 7.9389 19.1903 6.44999 17.75C6.90203 16.6495 7.67102 15.7083 8.65924 15.0459C9.64746 14.3835 10.8103 14.0298 12 14.0298C13.1897 14.0298 14.3525 14.3835 15.3407 15.0459C16.329 15.7083 17.0979 16.6495 17.55 17.75C16.0611 19.1903 14.0715 19.9969 12 20ZM9.99999 10C9.99999 9.60444 10.1173 9.21776 10.337 8.88886C10.5568 8.55996 10.8692 8.30362 11.2346 8.15224C11.6001 8.00087 12.0022 7.96126 12.3902 8.03843C12.7781 8.1156 13.1345 8.30608 13.4142 8.58579C13.6939 8.86549 13.8844 9.22186 13.9616 9.60982C14.0387 9.99778 13.9991 10.3999 13.8477 10.7654C13.6964 11.1308 13.44 11.4432 13.1111 11.6629C12.7822 11.8827 12.3955 12 12 12C11.4696 12 10.9608 11.7893 10.5858 11.4142C10.2107 11.0391 9.99999 10.5304 9.99999 10ZM18.91 16C18.0165 14.4718 16.6414 13.283 15 12.62C15.5092 12.0427 15.8409 11.3307 15.9555 10.5694C16.07 9.80822 15.9625 9.03011 15.6457 8.3285C15.329 7.62688 14.8166 7.03156 14.1699 6.61397C13.5232 6.19637 12.7698 5.97425 12 5.97425C11.2302 5.97425 10.4768 6.19637 9.83008 6.61397C9.1834 7.03156 8.67096 7.62688 8.35424 8.3285C8.03752 9.03011 7.92997 9.80822 8.04452 10.5694C8.15906 11.3307 8.49082 12.0427 8.99999 12.62C7.35859 13.283 5.98346 14.4718 5.08999 16C4.37793 14.7871 4.00171 13.4065 3.99999 12C3.99999 9.87827 4.84284 7.84344 6.34313 6.34315C7.84342 4.84285 9.87826 4 12 4C14.1217 4 16.1566 4.84285 17.6568 6.34315C19.1571 7.84344 20 9.87827 20 12C19.9983 13.4065 19.622 14.7871 18.91 16Z" fill="#F2F5F9" />
									</svg>
								)}
							</div>
							<div className="text">
								<p className="name">Meo Sky</p>
								<p className="email">meosky@gmail.com</p>
							</div>
						</div>
						<p className='account-text'>Account</p>
						<ul>
							<li>
								<span>
									<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
										<path d="M12 2C10.0605 2.00369 8.16387 2.57131 6.54122 3.63374C4.91856 4.69617 3.63988 6.20754 2.86093 7.98377C2.08197 9.76 1.83636 11.7244 2.15401 13.6378C2.47166 15.5511 3.33887 17.3308 4.64999 18.76C5.58641 19.775 6.72293 20.5851 7.98793 21.1392C9.25292 21.6933 10.619 21.9793 12 21.9793C13.381 21.9793 14.7471 21.6933 16.012 21.1392C17.277 20.5851 18.4136 19.775 19.35 18.76C20.6611 17.3308 21.5283 15.5511 21.846 13.6378C22.1636 11.7244 21.918 9.76 21.139 7.98377C20.3601 6.20754 19.0814 4.69617 17.4588 3.63374C15.8361 2.57131 13.9395 2.00369 12 2ZM12 20C9.92845 19.9969 7.9389 19.1903 6.44999 17.75C6.90203 16.6495 7.67102 15.7083 8.65924 15.0459C9.64746 14.3835 10.8103 14.0298 12 14.0298C13.1897 14.0298 14.3525 14.3835 15.3407 15.0459C16.329 15.7083 17.0979 16.6495 17.55 17.75C16.0611 19.1903 14.0715 19.9969 12 20ZM9.99999 10C9.99999 9.60444 10.1173 9.21776 10.337 8.88886C10.5568 8.55996 10.8692 8.30362 11.2346 8.15224C11.6001 8.00087 12.0022 7.96126 12.3902 8.03843C12.7781 8.1156 13.1345 8.30608 13.4142 8.58579C13.6939 8.86549 13.8844 9.22186 13.9616 9.60982C14.0387 9.99778 13.9991 10.3999 13.8477 10.7654C13.6964 11.1308 13.44 11.4432 13.1111 11.6629C12.7822 11.8827 12.3955 12 12 12C11.4696 12 10.9608 11.7893 10.5858 11.4142C10.2107 11.0391 9.99999 10.5304 9.99999 10ZM18.91 16C18.0165 14.4718 16.6414 13.283 15 12.62C15.5092 12.0427 15.8409 11.3307 15.9555 10.5694C16.07 9.80822 15.9625 9.03011 15.6457 8.3285C15.329 7.62688 14.8166 7.03156 14.1699 6.61397C13.5232 6.19637 12.7698 5.97425 12 5.97425C11.2302 5.97425 10.4768 6.19637 9.83008 6.61397C9.1834 7.03156 8.67096 7.62688 8.35424 8.3285C8.03752 9.03011 7.92997 9.80822 8.04452 10.5694C8.15906 11.3307 8.49082 12.0427 8.99999 12.62C7.35859 13.283 5.98346 14.4718 5.08999 16C4.37793 14.7871 4.00171 13.4065 3.99999 12C3.99999 9.87827 4.84284 7.84344 6.34313 6.34315C7.84342 4.84285 9.87826 4 12 4C14.1217 4 16.1566 4.84285 17.6568 6.34315C19.1571 7.84344 20 9.87827 20 12C19.9983 13.4065 19.622 14.7871 18.91 16Z" fill="#000" />
									</svg>
								</span>
								<p><Link to={'/profileSettings'}>Profile settings</Link></p>
							</li>
							<li>
								<span>
									<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
										<path d="M18 15V5C18 4.20435 17.6839 3.44129 17.1213 2.87868C16.5587 2.31607 15.7956 2 15 2H5C4.20435 2 3.44129 2.31607 2.87868 2.87868C2.31607 3.44129 2 4.20435 2 5V15C2 15.7956 2.31607 16.5587 2.87868 17.1213C3.44129 17.6839 4.20435 18 5 18H15C15.7956 18 16.5587 17.6839 17.1213 17.1213C17.6839 16.5587 18 15.7956 18 15ZM4 5C4 4.73478 4.10536 4.48043 4.29289 4.29289C4.48043 4.10536 4.73478 4 5 4H15C15.2652 4 15.5196 4.10536 15.7071 4.29289C15.8946 4.48043 16 4.73478 16 5V9.36L14.92 8.27C14.44 7.78988 13.7889 7.5201 13.11 7.52C12.4315 7.52228 11.7812 7.79173 11.3 8.27L10.39 9.18L9.58 8.37C9.03194 7.83074 8.29388 7.52851 7.525 7.52851C6.75612 7.52851 6.01806 7.83074 5.47 8.37L4 9.85V5ZM4.12 15.45C4.04289 15.3124 4.00162 15.1577 4 15V12.67L6.88 9.79C6.96456 9.70504 7.06507 9.63762 7.17576 9.59162C7.28645 9.54561 7.40513 9.52193 7.525 9.52193C7.64487 9.52193 7.76356 9.54561 7.87424 9.59162C7.98493 9.63762 8.08544 9.70504 8.17 9.79L9 10.6L4.12 15.45ZM12.72 9.69C12.7693 9.63577 12.8296 9.59259 12.8968 9.56329C12.964 9.53399 13.0367 9.51924 13.11 9.52C13.1833 9.51924 13.256 9.53399 13.3232 9.56329C13.3904 9.59259 13.4507 9.63577 13.5 9.69L16 12.18V15C16 15.2652 15.8946 15.5196 15.7071 15.7071C15.5196 15.8946 15.2652 16 15 16H6.4L12.72 9.69ZM21 6C20.7348 6 20.4804 6.10536 20.2929 6.29289C20.1054 6.48043 20 6.73478 20 7V17C20 17.7956 19.6839 18.5587 19.1213 19.1213C18.5587 19.6839 17.7956 20 17 20H7C6.73478 20 6.48043 20.1054 6.29289 20.2929C6.10536 20.4804 6 20.7348 6 21C6 21.2652 6.10536 21.5196 6.29289 21.7071C6.48043 21.8946 6.73478 22 7 22H17C18.3261 22 19.5979 21.4732 20.5355 20.5355C21.4732 19.5979 22 18.3261 22 17V7C22 6.73478 21.8946 6.48043 21.7071 6.29289C21.5196 6.10536 21.2652 6 21 6Z" fill="#000" />
									</svg>
								</span>
								<p><Link to={'/projectsSettings'}>Projects settings</Link></p>
							</li>
							<li>
								<span>
									<svg width="24" height="24" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
										<path d="M10.6917 11.2083C10.6155 11.0949 10.5125 11.002 10.3919 10.9377C10.2713 10.8734 10.1367 10.8398 10 10.8398C9.86335 10.8398 9.72878 10.8734 9.60816 10.9377C9.48754 11.002 9.38458 11.0949 9.30835 11.2083L5.97502 16.2083C5.90188 16.335 5.86338 16.4787 5.86338 16.625C5.86338 16.7713 5.90188 16.915 5.97502 17.0417C6.04023 17.1718 6.1384 17.2826 6.25975 17.363C6.38111 17.4435 6.52141 17.4907 6.66669 17.5H13.3334C13.4841 17.4996 13.6319 17.4583 13.7611 17.3805C13.8902 17.3028 13.9958 17.1914 14.0667 17.0583C14.1336 16.928 14.165 16.7824 14.1577 16.6361C14.1503 16.4898 14.1046 16.348 14.025 16.225L10.6917 11.2083ZM8.22502 15.8333L10 13.1667L11.775 15.8333H8.22502ZM15.8334 2.5H4.16669C3.50365 2.5 2.86776 2.76339 2.39892 3.23223C1.93008 3.70107 1.66669 4.33696 1.66669 5V12.5C1.66669 13.163 1.93008 13.7989 2.39892 14.2678C2.86776 14.7366 3.50365 15 4.16669 15H4.87502C5.09603 15 5.308 14.9122 5.46428 14.7559C5.62056 14.5996 5.70835 14.3877 5.70835 14.1667C5.70835 13.9457 5.62056 13.7337 5.46428 13.5774C5.308 13.4211 5.09603 13.3333 4.87502 13.3333H4.16669C3.94567 13.3333 3.73371 13.2455 3.57743 13.0893C3.42115 12.933 3.33335 12.721 3.33335 12.5V5C3.33335 4.77899 3.42115 4.56702 3.57743 4.41074C3.73371 4.25446 3.94567 4.16667 4.16669 4.16667H15.8334C16.0544 4.16667 16.2663 4.25446 16.4226 4.41074C16.5789 4.56702 16.6667 4.77899 16.6667 5V12.5C16.6667 12.721 16.5789 12.933 16.4226 13.0893C16.2663 13.2455 16.0544 13.3333 15.8334 13.3333H15.125C14.904 13.3333 14.692 13.4211 14.5358 13.5774C14.3795 13.7337 14.2917 13.9457 14.2917 14.1667C14.2917 14.3877 14.3795 14.5996 14.5358 14.7559C14.692 14.9122 14.904 15 15.125 15H15.8334C16.4964 15 17.1323 14.7366 17.6011 14.2678C18.07 13.7989 18.3334 13.163 18.3334 12.5V5C18.3334 4.33696 18.07 3.70107 17.6011 3.23223C17.1323 2.76339 16.4964 2.5 15.8334 2.5Z" fill="#000" />
									</svg>
								</span>
								<p><Link to={'/portfolio'} target='_blank'>My Portfolio</Link></p>
								<span className="new-page">
									<svg width="12" height="12" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg">
										<path d="M8 4.41C7.86739 4.41 7.74021 4.46268 7.64645 4.55645C7.55268 4.65021 7.5 4.77739 7.5 4.91V8.5C7.5 8.63261 7.44732 8.75979 7.35355 8.85355C7.25979 8.94732 7.13261 9 7 9H1.5C1.36739 9 1.24021 8.94732 1.14645 8.85355C1.05268 8.75979 1 8.63261 1 8.5V3C1 2.86739 1.05268 2.74021 1.14645 2.64645C1.24021 2.55268 1.36739 2.5 1.5 2.5H5.09C5.22261 2.5 5.34979 2.44732 5.44355 2.35355C5.53732 2.25979 5.59 2.13261 5.59 2C5.59 1.86739 5.53732 1.74021 5.44355 1.64645C5.34979 1.55268 5.22261 1.5 5.09 1.5H1.5C1.10218 1.5 0.720644 1.65804 0.43934 1.93934C0.158035 2.22064 0 2.60218 0 3V8.5C0 8.89782 0.158035 9.27936 0.43934 9.56066C0.720644 9.84196 1.10218 10 1.5 10H7C7.39782 10 7.77936 9.84196 8.06066 9.56066C8.34196 9.27936 8.5 8.89782 8.5 8.5V4.91C8.5 4.77739 8.44732 4.65021 8.35355 4.55645C8.25979 4.46268 8.13261 4.41 8 4.41ZM9.96 0.31C9.90926 0.187825 9.81217 0.0907374 9.69 0.04C9.62989 0.0143795 9.56534 0.000789994 9.5 0H6.5C6.36739 0 6.24021 0.0526784 6.14645 0.146447C6.05268 0.240215 6 0.367392 6 0.5C6 0.632608 6.05268 0.759785 6.14645 0.853553C6.24021 0.947322 6.36739 1 6.5 1H8.295L3.145 6.145C3.09814 6.19148 3.06094 6.24678 3.03555 6.30771C3.01017 6.36864 2.9971 6.43399 2.9971 6.5C2.9971 6.56601 3.01017 6.63136 3.03555 6.69229C3.06094 6.75322 3.09814 6.80852 3.145 6.855C3.19148 6.90186 3.24678 6.93906 3.30771 6.96445C3.36864 6.98983 3.43399 7.0029 3.5 7.0029C3.56601 7.0029 3.63136 6.98983 3.69229 6.96445C3.75322 6.93906 3.80852 6.90186 3.855 6.855L9 1.705V3.5C9 3.63261 9.05268 3.75979 9.14645 3.85355C9.24021 3.94732 9.36739 4 9.5 4C9.63261 4 9.75979 3.94732 9.85355 3.85355C9.94732 3.75979 10 3.63261 10 3.5V0.5C9.99921 0.434661 9.98562 0.370111 9.96 0.31V0.31Z" fill="#677489" />
									</svg>

								</span>
							</li>
						</ul>
						<div className="logout" onClick={handleLogout}>
							<span>
								<svg width="24" height="24" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
									<path d="M3.33331 9.99996C3.33331 10.221 3.42111 10.4329 3.57739 10.5892C3.73367 10.7455 3.94563 10.8333 4.16665 10.8333H10.4916L8.57498 12.7416C8.49687 12.8191 8.43488 12.9113 8.39257 13.0128C8.35026 13.1144 8.32848 13.2233 8.32848 13.3333C8.32848 13.4433 8.35026 13.5522 8.39257 13.6538C8.43488 13.7553 8.49687 13.8475 8.57498 13.925C8.65245 14.0031 8.74462 14.0651 8.84617 14.1074C8.94771 14.1497 9.05664 14.1715 9.16665 14.1715C9.27666 14.1715 9.38558 14.1497 9.48713 14.1074C9.58868 14.0651 9.68084 14.0031 9.75831 13.925L13.0916 10.5916C13.1675 10.5124 13.227 10.4189 13.2666 10.3166C13.35 10.1137 13.35 9.88618 13.2666 9.68329C13.227 9.581 13.1675 9.48755 13.0916 9.40829L9.75831 6.07496C9.68061 5.99726 9.58837 5.93563 9.48685 5.89358C9.38534 5.85153 9.27653 5.82988 9.16665 5.82988C9.05676 5.82988 8.94796 5.85153 8.84644 5.89358C8.74492 5.93563 8.65268 5.99726 8.57498 6.07496C8.49728 6.15266 8.43565 6.2449 8.3936 6.34642C8.35155 6.44794 8.3299 6.55674 8.3299 6.66663C8.3299 6.77651 8.35155 6.88532 8.3936 6.98683C8.43565 7.08835 8.49728 7.18059 8.57498 7.25829L10.4916 9.16663H4.16665C3.94563 9.16663 3.73367 9.25442 3.57739 9.4107C3.42111 9.56698 3.33331 9.77895 3.33331 9.99996ZM14.1666 1.66663H5.83331C5.17027 1.66663 4.53439 1.93002 4.06555 2.39886C3.59671 2.8677 3.33331 3.50358 3.33331 4.16663V6.66663C3.33331 6.88764 3.42111 7.0996 3.57739 7.25588C3.73367 7.41216 3.94563 7.49996 4.16665 7.49996C4.38766 7.49996 4.59962 7.41216 4.7559 7.25588C4.91218 7.0996 4.99998 6.88764 4.99998 6.66663V4.16663C4.99998 3.94561 5.08778 3.73365 5.24406 3.57737C5.40034 3.42109 5.6123 3.33329 5.83331 3.33329H14.1666C14.3877 3.33329 14.5996 3.42109 14.7559 3.57737C14.9122 3.73365 15 3.94561 15 4.16663V15.8333C15 16.0543 14.9122 16.2663 14.7559 16.4225C14.5996 16.5788 14.3877 16.6666 14.1666 16.6666H5.83331C5.6123 16.6666 5.40034 16.5788 5.24406 16.4225C5.08778 16.2663 4.99998 16.0543 4.99998 15.8333V13.3333C4.99998 13.1123 4.91218 12.9003 4.7559 12.744C4.59962 12.5878 4.38766 12.5 4.16665 12.5C3.94563 12.5 3.73367 12.5878 3.57739 12.744C3.42111 12.9003 3.33331 13.1123 3.33331 13.3333V15.8333C3.33331 16.4963 3.59671 17.1322 4.06555 17.6011C4.53439 18.0699 5.17027 18.3333 5.83331 18.3333H14.1666C14.8297 18.3333 15.4656 18.0699 15.9344 17.6011C16.4033 17.1322 16.6666 16.4963 16.6666 15.8333V4.16663C16.6666 3.50358 16.4033 2.8677 15.9344 2.39886C15.4656 1.93002 14.8297 1.66663 14.1666 1.66663Z" fill="#DD524C" />
								</svg>

							</span>
							<a href="#">
								Log out
							</a>
						</div>
					</div>
				)}
			</div>

		</nav>
	)
}

export default NavBar
